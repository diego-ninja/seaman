services:
  app:
    image: seaman/seaman-php{{ php_version }}:latest
    container_name: seaman-app
    build:
      context: .
      dockerfile: .seaman/Dockerfile
      args:
        WWWGROUP: ${WWWGROUP:-1000}
        PHP_VERSION: ${PHP_VERSION:-{{ php_version }}}
    volumes:
      - .:/var/www/html
      - .seaman/scripts/xdebug-toggle.sh:/usr/local/bin/xdebug-toggle
    environment:
      - XDEBUG_MODE=${XDEBUG_MODE:-off}
      - PHP_IDE_CONFIG=serverName=seaman
{% if services.enabled|length > 0 %}
    depends_on:
{% for name, service in services.enabled %}
      - {{ name }}
{% endfor %}
{% endif %}
    labels:
{% for label in app_labels %}
      - "{{ label }}"
{% endfor %}
    networks:
      - seaman

{% for name, service in services.enabled %}
{% include 'docker/services/' ~ service.config.type.value ~ '.twig' with { name: name, service: service.config, labels: service.labels } %}

{% endfor %}
networks:
  seaman:
    driver: bridge

{% if volumes.persist|length > 0 %}
volumes:
{% for volume in volumes.persist %}
  {{ volume }}:
{% endfor %}
{% endif %}
